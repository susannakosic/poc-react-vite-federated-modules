version: 2.1

orbs:
  node: circleci/node@4.7.0  

# default pipeline parameters, which will be updated according to
# the results of the path-filtering orb
parameters:
  run-app-job:
    type: boolean
    default: false
  run-shared-job:
    type: boolean
    default: false

# conditional workflows
# executed based upon pipeline parameter values. Each workflow calls a
# specific job defined below

jobs:
  build-app:
    docker:
      - image: cimg/node:17.2.0
    steps:
      - checkout
      - node/install-packages:
          pkg-manager: yarn      
      - run:
          command: yarn workspace app build
          name: Build app
      - persist_to_workspace:
          root: ~/project
          paths:
            - .
  
  build-shared:
    docker:
      - image: cimg/node:17.2.0
    steps:
      - checkout
      - node/install-packages:
          pkg-manager: yarn      
      - run:
          command: yarn workspace app shared
          name: Build shared
      - persist_to_workspace:
          root: ~/project
          paths:
            - .
  
workflows:
  # triggers when pipeline parameter run-app-job is true
  run-app-job:
    when: << pipeline.parameters.run-app-job >>
    jobs:
      - build-app

  run-shared-job:
    when: << pipeline.parameters.run-shared-job >>
    jobs:
      - build-shared